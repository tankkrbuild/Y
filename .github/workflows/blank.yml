name: Ubuntu

on:
  schedule:
    - cron: "0 */6 * * *"  
  workflow_dispatch:        
  push:
    branches:
      - main
jobs:
  run-script:
    runs-on: ubuntu-latest
    steps:
      - name: Install Cloudflared
        run: |
          # Add cloudflare gpg key
          sudo mkdir -p --mode=0755 /usr/share/keyrings
          curl -fsSL https://pkg.cloudflare.com/cloudflare-main.gpg | sudo tee /usr/share/keyrings/cloudflare-main.gpg >/dev/null

          # Add this repo to your apt repositories
          echo 'deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/cloudflared any main' | sudo tee /etc/apt/sources.list.d/cloudflared.list

          # install cloudflared
          sudo apt-get update && sudo apt-get install cloudflared

      - name: Setup Cloudflared
        run: |
          sudo cloudflared service install eyJhIjoiOWFjMWUxOTExMmU5ZWZmZDIzNmFlNDk1NDIyYmY2ZjgiLCJ0IjoiOTFhZjIzOWQtMDA1My00YjhhLWE2ZTItYjFkODhhNGU3YWM0IiwicyI6Ik1ETTROekZqTWpBdE5EazJZUzAwTTJZekxUbGtOVGd0WWpCbFltWXhNMk5tTVdFMSJ9
          cloudflared tunnel run --token eyJhIjoiOWFjMWUxOTExMmU5ZWZmZDIzNmFlNDk1NDIyYmY2ZjgiLCJ0IjoiOTFhZjIzOWQtMDA1My00YjhhLWE2ZTItYjFkODhhNGU3YWM0IiwicyI6Ik1ETTROekZqTWpBdE5EazJZUzAwTTJZekxUbGtOVGd0WWpCbFltWXhNMk5tTVdFMSJ9 &

      - name: Tambah User cihuyy
        run: |
          sudo apt remove man-db -y
          sudo adduser --uid 1224 --disabled-password --gecos "" cihuyy
          echo "cihuyy ALL=(ALL) NOPASSWD:ALL" | sudo tee -a /etc/sudoers.d/cihuyy
          sudo apt install fish
          wget https://github.com/tsl0922/ttyd/releases/download/1.7.7/ttyd.x86_64
          chmod +x ttyd.x86_64
          sudo mv ttyd.x86_64 /usr/bin/ttyd
          echo 'XDG_CONFIG_HOME=/home/cihuyy/.config' | sudo tee -a /etc/environment
          #sudo cp -r .config /home/cihuyy
          #sudo -u cihuyy mkdir -p /home/cihuyy/.config/fish
          TEMP=$(mktemp -d)
          wget -O "$TEMP/font.zip" "https://github.com/ryanoasis/nerd-fonts/releases/download/v3.4.0/JetBrainsMono.zip"
          unzip "$TEMP/font.zip" -d "$TEMP"
          sudo mv "$TEMP"/*.{ttf,otf} /usr/local/share/fonts/
          fc-cache -f -v
          sudo rm -rf "$TEMP"
          echo "Font berhasil diinstal!"
          cd /home/cihuyy
          sudo curl -sS https://starship.rs/install.sh -o install.sh
          sudo chmod +x install.sh
          sudo -u cihuyy sh install.sh --yes
          sudo -u cihuyy fish -c 'fish'
          sudo -u cihuyy fish -c 'starship init fish | source'
          echo "starship init fish | source" | sudo tee -a /home/cihuyy/.config/fish/config.fish
          sudo -u cihuyy starship preset tokyo-night -o /home/cihuyy/.config/starship.toml
          sudo wget -qO fastfetch.tar.gz https://github.com/fastfetch-cli/fastfetch/releases/latest/download/fastfetch-linux-amd64.tar.gz
          sudo chmod 777 fastfetch.tar.gz
          sudo tar -xf fastfetch.tar.gz --strip-components=3 -C /usr/local/bin fastfetch-linux-amd64/usr/bin/fastfetch
          sudo chmod +x /usr/local/bin/fastfetch
          echo "fastfetch" | sudo tee -a /home/cihuyy/.config/fish/config.fish
          sudo -u cihuyy ttyd -p 5678 -W -t cursorStyle=bar -t 'theme={"background": "#1A1B2F"}' -t fontFamily="JetBrainsMono Nerd Font" /usr/bin/fish

          
